"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var h=e[i];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(t,h.key,h)}}return function(e,i,h){return i&&t(e.prototype,i),h&&t(e,h),e}}(),AVLTree=function(){function t(e){_classCallCheck(this,t),e&&(this.root=new Node(e))}return _createClass(t,[{key:"insert",value:function(t){return this.root?this.root.insert(t):this.root=new Node(t),this.update(),this.balance(),this}},{key:"remove",value:function(t){this.root&&(this.root.remove(t,this),this.update(),this.balance())}},{key:"update",value:function(){this.root&&this.root.update()}},{key:"rotateRight",value:function(t){this.root.get(t).rotateRight(this),this.root.update()}},{key:"rotateLeft",value:function(t){this.root.get(t).rotateLeft(this),this.root.update()}},{key:"balance",value:function(){if(this.root){var t=0,e=null;this.root.posOrder(function(i){Math.abs(i.balancing)>=2&&1==++t&&(e=i)}),0!=t&&(e.balancing<0?e.left.balancing>0?this.doubleRotateLeft(e.value):this.rotateRight(e.value):e.right.balancing<0?this.doubleRotateRight(e.value):this.rotateLeft(e.value),this.balance())}}},{key:"doubleRotateLeft",value:function(t){var e=this.root.get(t);e.left.rotateLeft(this),e.rotateRight(this),this.root.update()}},{key:"doubleRotateRight",value:function(t){var e=this.root.get(t);e.right.rotateRight(this),e.rotateLeft(this),this.root.update()}},{key:"preOrder",value:function(t){this.root.preOrder(t)}}]),t}(),Node=function(){function t(e,i){_classCallCheck(this,t),this.value=e,this.parent=i,this.height=0,i&&(this.height=i.height+1)}return _createClass(t,[{key:"updateLevel",value:function(){this.level=this.parent?1+this.parent.level:0}},{key:"updateHeight",value:function(){var t=0;null!=this.left&&(this.left.updateHeight(),t=this.left.height),null!=this.right&&(this.right.updateHeight(),this.right.height>t&&(t=this.right.height)),this.height=t+1}},{key:"rotateLeft",value:function(t){var e=this.right,i=e.left;if(e.left=this,e.parent=this.parent,this.parent=e,this.right=i,i&&(i.parent=this),null!=e.parent){var h=e.parent.left==this?"left":"right";e.parent[h]=e}else t.root=e,e.parent=null}},{key:"rotateRight",value:function(t){var e=this.left,i=e.right;if(e.right=this,e.parent=this.parent,this.parent=e,this.left=i,i&&(i.parent=this),null!=e.parent){var h=e.parent.left==this?"left":"right";e.parent[h]=e}else t.root=e,e.parent=null}},{key:"isLeaf",value:function(){return!this.left&&!this.right}},{key:"countNodes",value:function(){if(this.isLeaf())return 1;var t=1;return this.left&&(t+=this.left.countNodes()),this.right&&(t+=this.right.countNodes()),t}},{key:"remove",value:function(t,e){if(this.value==t){var i,h=!this.parent;if(h||(i=this.parent.left==this?"left":"right"),this.isLeaf()&&(h?e.root=null:this.parent[i]=null),this.left&&this.right){var r=this.left.countChilds(),s=this.right.countChilds(),n=void 0;r>=s?(0==r?(n=this.left,n.left=null):(n=this.antecessor(),n.parent.right=n.left,n.left&&(n.left.parent=n.parent),n.left=this.left,n.left&&(n.left.parent=n)),n.parent=this.parent,n.right=this.right,n.right.parent=n):(0==s?(n=this.right,n.right=null):(n=this.successor(),n.parent.left=n.right,n.right&&(n.right.parent=n.parent),n.right=this.right,n.right&&(n.right.parent=n)),n.parent=this.parent,n.left=this.left,n.left.parent=n),h?e.root=n:n.parent[i]=n}else if(this.left){var a=this.left;a.left=null,a.right=this.right,a.parent=this.parent,h?e.root=a:a.parent[i]=a}else if(this.right){var l=this.right;l.right=null,l.left=this.left,l.parent=this.parent,h?e.root=l:l.parent[i]=l}}t>this.value&&this.right&&this.right.remove(t,e),t<this.value&&this.left&&this.left.remove(t,e)}},{key:"countChilds",value:function(){return this.countNodes()-1}},{key:"posOrder",value:function(t){this.left&&this.left.posOrder(),this.right&&this.right.posOrder(),t(this)}},{key:"update",value:function(){this.preOrder(function(t){t.updateLevel()}),this.updateHeight(),this.updateBalancing()}},{key:"updateBalancing",value:function(){var t=0;this.right&&(t=this.right.height,this.right.updateBalancing()),this.left&&(t-=this.left.height,this.left.updateBalancing()),this.balancing=t}},{key:"hasValue",value:function(t){return this.value==t||(t<this.value?!!this.left&&this.left.hasValue(t):t>this.value?!!this.right&&this.right.hasValue(t):void 0)}},{key:"insert",value:function(e){return e>this.value&&(this.right?this.right.insert(e):this.right=new t(e,this)),e<this.value&&(this.left?this.left.insert(e):this.left=new t(e,this)),this.update(),this}},{key:"get",value:function(t){return this.hasValue(t)?t==this.value?this:t<this.value?this.left.get(t):t>this.value?this.right.get(t):void 0:null}},{key:"biggest",value:function(){return this.right?this.right.biggest():this}},{key:"smallest",value:function(){return this.left?this.left.smallest():this}},{key:"successor",value:function(){return this.right?this.right.smallest():null}},{key:"antecessor",value:function(){return this.left?this.left.biggest():null}},{key:"preOrder",value:function(t){t(this),this.left&&this.left.preOrder(t),this.right&&this.right.preOrder(t)}},{key:"posOrder",value:function(t){this.left&&this.left.posOrder(t),this.right&&this.right.posOrder(t),t(this)}},{key:"inOrder",value:function(t){this.left&&this.left.posOrder(t),t(this),this.right&&this.right.posOrder(t)}},{key:"getUnbalancedsfunction",value:function(){var t=[];return this.update(),this.preOrder(function(e){Math.abs(e.balancing)>=2&&t.push(e)}),t}}]),t}();module.exports=AVLTree;